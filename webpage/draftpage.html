<!DOCTYPE html>
<head lang="en">
    <title>2022 FootballMockDraft</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">

    <script>
        async function getPlayerLeft() {
            var res = await fetch("http://localhost:8080/api/teams/getPlayersLeft/",{
                method: 'GET',
            })
            var data = await res.json()
            console.log(data)
            var returnVal = ""
            for(var intCurrPlayer in data) {
                currPlayer = data[intCurrPlayer]
                returnVal += ((1+Number(intCurrPlayer)) + ". " + currPlayer.fullName + " " +currPlayer.position + " - Predicted Score 2022 = " 
                + currPlayer.predictedScore + ", Avg ADP = " + currPlayer.avgADP + "<br />")
        }
        console.log(returnVal)
        document.getElementById("playerListPar").innerHTML = returnVal
    }
    </script>

    <script>
        async function updatePlayerListPar(data) {
            returnVal = ""
            for(var intCurrPlayer in data) {
                currPlayer = data[intCurrPlayer]
                returnVal += ((1+Number(intCurrPlayer)) + ". " + currPlayer.fullName + " " +currPlayer.position + " - Predicted Score 2022 = " 
                + currPlayer.predictedScore + ", Avg ADP = " + currPlayer.avgADP + "<br />")
            }
            document.getElementById("playerListPar").innerHTML = returnVal
        }
    </script>

    <script>
        async function startDraft() {

            function checkStartDraftInput(teamName,draftSize,draftPosition) {
                if (typeof teamName != "string") {
                    alert(teamName + " - Not a valid string value to name your team. Try again.")
                    return false
                }
                if (typeof draftSize != "number" ||
                   !Number.isInteger(draftSize)) {
                        alert(draftSize + " - Not a valid int entered for the draft size. Try again.")
                        return false
                }
                if (typeof draftPosition != "number" ||
                    !Number.isInteger(draftPosition) ||
                    draftPosition > draftSize) {
                        alert(draftPosition + " - Not a valid int entered for your starting draft position. Try again.")
                        return false
                }
                return true
            }

            var teamName = document.getElementById("teamNameInput").value
            var draftSize = document.getElementById("sizeOfTeamsInput").value
            draftSize = parseInt(draftSize)
            var draftPosition = document.getElementById("draftPositionInput").value
            draftPosition = parseInt(draftPosition)

            if (checkStartDraftInput(teamName,draftSize,draftPosition) == true) {
                var res = await 
                fetch(("http://localhost:8080/api/teams/startDraft/?teamName="+teamName+"&draftSize="+draftSize+"&draftPosition="+draftPosition), {
                    body: JSON.stringify({
                        teamName:teamName,
                        draftSize:draftSize,
                        draftPosition:draftPosition, 
                    }),
                    method: 'POST',
                })
                var data = await res.json()
                console.log(data)

                document.getElementById("draftFormDiv").innerHTML = "";
                updatePlayerListPar(data)
                if (draftPosition == 1) {
                    document.getElementById("draftControllerForm").style.display = "block";
                    document.getElementById("currPick").innerHTML = "1";
                    document.getElementById("nextUserPick").innerHTML = "1";
                }
                else {
                    document.getElementById("waitingDraftControllerForm").style.display = "block";
                    document.getElementById("currPick").innerHTML = "1";
                    document.getElementById("nextUserPick").innerHTML = draftPosition;

                }
                document.getElementById("draftLogPar").innerHTML = "Waiting for user input...";
            }
        }
    </script>

<script>
    function updateDraftLogPar(data) {
        returnVal = ""
        for(var nextDraftPick in data) {
                returnVal += data[nextDraftPick] + "<br />"
            }
        document.getElementById("draftLogPar").innerHTML = returnVal
    }
</script>

    <script>
        async function simulateToNextPick() {
            var nextUserPick = parseInt(document.getElementById("nextUserPick").innerHTML)
            var res = await
            fetch(("http://localhost:8080/api/teams/simTo/?nextUserPick="+nextUserPick), {
                body: JSON.stringify({
                        nextUserPick:nextUserPick,
                    }),
                    method: 'POST',
                })
            var data = await res.json()
            console.log(data)

            document.getElementById("draftLogPar").innerHTML = ""
            updateDraftLogPar(data);
            
            document.getElementById("draftControllerForm").style.display = "block";
            document.getElementById("currPick").innerHTML = nextUserPick
            document.getElementById("nextUserPick").innerHTML = nextUserPick;

            await getPlayerLeft();

            
        }
        
    </script>

</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12" style="text-align: center">
                <h1> 2022 Fantasy Football Mock Draft Sim</h1>
                <p><b>Beta Version 1.0</b></p>
            </div>
        </div>
        <div class="row" id="draftFormDiv">
            <div class="col-sm-12" style="text-align: center">
                <p>Fill out the info below to start a draft</p>
                <div id="getDraftInfo">
                    <form id="getDraftForm" active="false">
                        <p>Team Name: <input type="text" id="teamNameInput"></p>
                        <p>Number of Teams To Draft Against: <input type="text" id="sizeOfTeamsInput"></p>
                        <p>Enter Your Desired Draft Position: <input type="text" id="draftPositionInput"></p>
                        <input type="button" value="Start Draft" onClick="startDraft()">
                    </form>
                </div>
            </div>
        </div>
        <br>
        <div class="row" id="draftProgess">
            <div class="col-4"  id="playeLeftListCol">
                <div id="playerListDiv"> 
                    <h3 style="text-align: center">Players Left</h3>
                    <p id="playerListPar"></p> 
                </div>
            </div> 
            <div class="col-4" id="draftControllerCol">
                <div id="draftControllFormCol">
                    <h3 style="text-align: center">Draft Controls</h3>
                    <br>
                    <form id="waitingDraftControllerForm" style="display: none; text-align: center;">
                    <p>Currently pick is <span id="currPick">1</span>, your next pick is <span id="nextUserPick"></span>. 
                        Click the button below to simulate to your next draft pick.</p>
                    <input type="button" value="Simulate" onClick="simulateToNextPick()">  
                    </form>
                    <form id="draftControllerForm" style="display: none; text-align: center;">
                        <p>Enter number next to player to draft: <input type="text" id="nextDraftPick"></p>
                        <input type="button" value="Draft Player" onClick="draftPlayer(document.getElementById('nextDraftPick').value)">
                    </form>
                </div>
            </div>
            <div class="col-4" id="draftLogCol">
                <div id="draftLogDiv"> 
                <h3 style="text-align: center" >Draft Log</h3>
                <p style="text-align: center" id="draftLogPar"></p>
            </div> 
        </div>
    </div>
</body>